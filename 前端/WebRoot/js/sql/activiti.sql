-- 2015-5-5,修改字段类型
alter table REPORT_GGWS_YQTS ALTER COLUMN MCYJ SET DATA TYPE varchar(10) ;
alter table REPORT_GGWS_YQTS ALTER COLUMN JCRQ SET DATA TYPE varchar(10) ;

-- 2015-4-22,添加字段

alter table REPORT_GGWS_MONTH  add column  ISHZ varchar(1);
alter table REPORT_GGWS_QUARTER add column  ISHZ varchar(1);

-- 2015-04-10添加，KQ_DJ 表字段
alter table KQ_DJ  add column SBSJ5 TIMESTAMP;
alter table KQ_DJ  add column XBSJ5 TIMESTAMP;
alter table KQ_DJ  add column SBZT5 VARCHAR(1);
alter table KQ_DJ  add column XBZT5 VARCHAR(1);

alter table KQ_DJ  add column SBSJ6 TIMESTAMP;
alter table KQ_DJ  add column XBSJ6 TIMESTAMP;
alter table KQ_DJ  add column SBZT6 VARCHAR(1);
alter table KQ_DJ  add column XBZT6 VARCHAR(1);

-- 2015-03-27添加，工作日程添加共享功能以及定时提醒未完成日程
ALTER TABLE "DB2ADMIN"."GZ_WORK_SCHEDULE"
  ADD COLUMN ISSHARE	VARCHAR(1);

ALTER TABLE "DB2ADMIN"."GZ_WORK_SCHEDULE"
  ADD COLUMN USERCODEINFO	VARCHAR(200);

ALTER TABLE "DB2ADMIN"."GZ_WORK_SCHEDULE"
  ADD COLUMN ISCHECK	VARCHAR(1);

COMMENT ON "DB2ADMIN"."GZ_WORK_SCHEDULE" ( 
	"ISSHARE" IS '是否共享',
	"USERCODEINFO" IS '参与人员编码',
	"ISCHECK" IS '日程是否已查看' );

REORG TABLE "DB2ADMIN"."GZ_WORK_SCHEDULE";

COMMIT;

-- 2015-03-30添加，页面弹出未完成日程提醒
DROP VIEW "DB2ADMIN"."V_OANEWS";

SET SCHEMA = "DB2ADMIN";

SET CURRENT PATH = "SYSIBM","SYSFUN","SYSPROC","SYSIBMADM","DB2ADMIN";

CREATE VIEW "DB2ADMIN"."V_OANEWS"
    ( "TITLE", "USERCODE", "LX" )
AS
SELECT a.TITLE AS TITLE, b.JSRY AS USERCODE, '1' AS LX 
  FROM DB2ADMIN.GZ_NOTICE_MAIN a, DB2ADMIN.GZ_NOTICE_DETAIL b 
  WHERE a.ID = b.MID AND b.ISCHECK = '0'  
  UNION ALL  
  SELECT a.TITLE AS TITLE, b.JSRY AS USERCODE, '2' AS LX 
  FROM DB2ADMIN.EM_MAIL_REC_SEND a, DB2ADMIN.EM_MAIL_REC b 
  WHERE a.ID = b.MID AND b.ISCHECK = '0'  
  UNION ALL  
  SELECT a.GWTITLE AS TITLE, b.ASSIGNEE_ AS USERCODE, '3' AS LX 
  FROM DB2ADMIN.DOC_REC_MANAGER_MAIN a, DB2ADMIN.ACT_RU_TASK b 
  WHERE a.PROCESS_ID = b.PROC_INST_ID_ AND a.id = decimal (b.BUSINESS_KEY_) AND b.FLAG_ = '2' AND b.SUSPENSION_STATE_ = 1 AND b.ASSIGNEE_ IS NOT NULL  
  UNION ALL  
  SELECT a.GWTITLE AS TITLE, b.ASSIGNEE_ AS USERCODE, '4' AS LX 
  FROM DB2ADMIN.DOC_REC_MANAGER_MAIN a, DB2ADMIN.ACT_HI_TASKINST b 
  WHERE a.PROCESS_ID = b.PROC_INST_ID_ AND a.id = decimal (b.BUSINESS_KEY_) AND b.FLAG_ = '2' AND b.ASSIGNEE_ IS NOT NULL AND b.CLAIM_TIME_ IS NULL AND b.END_TIME_ IS NOT NULL  
  UNION ALL  
  SELECT a.GWTITLE AS TITLE, b.ASSIGNEE_ AS USERCODE, '5' AS LX 
  FROM DB2ADMIN.DOC_SEND_MANAGER_MAIN a, DB2ADMIN.ACT_RU_TASK b 
  WHERE a.PROCESS_ID = b.PROC_INST_ID_ AND a.id = decimal (b.BUSINESS_KEY_) AND b.FLAG_ = '3' AND b.SUSPENSION_STATE_ = 1 AND b.ASSIGNEE_ IS NOT NULL  
  UNION ALL  
  SELECT a.GWTITLE AS TITLE, b.ASSIGNEE_ AS USERCODE, '6' AS LX 
  FROM DB2ADMIN.DOC_SEND_MANAGER_MAIN a, DB2ADMIN.ACT_HI_TASKINST b 
  WHERE a.PROCESS_ID = b.PROC_INST_ID_ AND a.id = decimal (b.BUSINESS_KEY_) AND b.FLAG_ = '3' AND b.ASSIGNEE_ IS NOT NULL AND b.CLAIM_TIME_ IS NULL AND b.END_TIME_ IS NOT NULL  
  UNION ALL  
  SELECT a.USERCODE AS TITLE, b.ASSIGNEE_ AS USERCODE, '7' AS LX 
  FROM DB2ADMIN.KQ_QJDJ a, DB2ADMIN.ACT_RU_TASK b 
  WHERE a.PROCESS_ID = b.PROC_INST_ID_ AND a.id = decimal (b.BUSINESS_KEY_) AND b.FLAG_ = '1' AND b.SUSPENSION_STATE_ = 1 AND b.ASSIGNEE_ IS NOT NULL  
  UNION ALL  
  SELECT a.USERCODE AS TITLE, b.ASSIGNEE_ AS USERCODE, '8' AS LX 
  FROM DB2ADMIN.KQ_QJDJ a, DB2ADMIN.ACT_HI_TASKINST b 
  WHERE a.PROCESS_ID = b.PROC_INST_ID_ AND a.id = decimal (b.BUSINESS_KEY_) AND b.FLAG_ = '1' AND b.ASSIGNEE_ IS NOT NULL AND b.CLAIM_TIME_ IS NULL AND b.END_TIME_ IS NOT NULL AND b.DELETE_REASON_ = 'jump'
	UNION all
	SELECT TITLE, LRR AS USERCODE, '9' AS LX FROM GZ_WORK_SCHEDULE WHERE TXSJ < current timestamp AND ISCHECK IS NULL
WITH NO ROW MOVEMENT;

SET SCHEMA = DB2ADMIN;

SET CURRENT PATH = "SYSIBM","SYSFUN","SYSPROC","SYSIBMADM","DB2ADMIN";

COMMIT;

--2015-04-07 添加供货商添加单位编码标示 REGION
ALTER TABLE "DB2ADMIN"."DIC_WZZD"
  ADD COLUMN REGION	VARCHAR(10);

COMMENT ON "DB2ADMIN"."DIC_WZZD" ( 
	"REGION" IS '机构编码' );

REORG TABLE "DB2ADMIN"."DIC_WZZD";

COMMIT;


--2015-04-07 添加供货商添加单位编码标示 REGION
ALTER TABLE "DB2ADMIN"."DIC_GONGHUODW"
  ADD COLUMN REGION	VARCHAR(10);

REORG TABLE "DB2ADMIN"."DIC_GONGHUODW";

COMMIT;

--2015-04-07 添加WZ_PD_DETAIL批次
CREATE TABLE "DB2ADMIN"."TMP_WZ_PD_DETAIL_RPKSD" (
  "ID"	BIGINT	NOT NULL	GENERATED BY DEFAULT
    AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 20,
       NO MINVALUE, NO MAXVALUE, NO CYCLE, NO ORDER),
  "PDHOWID"	VARCHAR(50)	NOT NULL,
  "CODE"	VARCHAR(50)	NOT NULL,
  "NAME"	VARCHAR(50)	NOT NULL,
  PC	VARCHAR(10),
  "GG"	VARCHAR(20)	NOT NULL,
  "KCSL"	DECIMAL(18,5)	NOT NULL,
  "PDSL"	DECIMAL(18,5)	NOT NULL,
  "YKSL"	DECIMAL(18,5)	NOT NULL,
  "UNIT"	VARCHAR(10)	NOT NULL,
  "DJ"	DECIMAL(18,5)	NOT NULL
) 
  IN "SDCSM_TABLE_SPACE";

ALTER TABLE "DB2ADMIN"."TMP_WZ_PD_DETAIL_RPKSD"
  DATA CAPTURE NONE
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;

INSERT INTO "DB2ADMIN"."TMP_WZ_PD_DETAIL_RPKSD"( "ID", "PDHOWID", "CODE", "NAME", "GG", 

"KCSL", "PDSL", "YKSL", "UNIT", "DJ" )
SELECT "ID", "PDHOWID", "CODE", "NAME", "GG", "KCSL", "PDSL", "YKSL", "UNIT", "DJ"
FROM "DB2ADMIN"."WZ_PD_DETAIL";

DROP TABLE "DB2ADMIN"."WZ_PD_DETAIL";

RENAME TABLE "DB2ADMIN"."TMP_WZ_PD_DETAIL_RPKSD" TO "WZ_PD_DETAIL";

ALTER TABLE "DB2ADMIN"."WZ_PD_DETAIL"
  ADD CONSTRAINT "PK_WZ_PD_DETAIL" PRIMARY KEY
    ("ID");

GRANT CONTROL ON TABLE "DB2ADMIN"."WZ_PD_DETAIL" TO USER "DB2INST1";

GRANT SELECT, INSERT, UPDATE, ALTER, DELETE,
    INDEX, REFERENCES ON TABLE "DB2ADMIN"."WZ_PD_DETAIL" TO USER "DB2INST1" WITH GRANT OPTION;

GRANT CONTROL ON TABLE "DB2ADMIN"."WZ_PD_DETAIL" TO USER "DB2ADMIN";

GRANT SELECT, INSERT, UPDATE, ALTER, DELETE,
    INDEX, REFERENCES ON TABLE "DB2ADMIN"."WZ_PD_DETAIL" TO USER "DB2ADMIN" WITH GRANT OPTION;


COMMIT;

RUNSTATS ON TABLE "DB2ADMIN"."WZ_PD_DETAIL"
  AND INDEXES ALL
  ALLOW READ ACCESS;

COMMIT;


--2015-04-07 添加WZ_BS_DETAIL批次
CREATE TABLE "DB2ADMIN"."TMP_WZ_BS_DETAIL_XLWAF" (
  "ID"	BIGINT	NOT NULL	GENERATED BY DEFAULT
    AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 20,
       NO MINVALUE, NO MAXVALUE, NO CYCLE, NO ORDER),
  "BSHOWID"	VARCHAR(50)	NOT NULL,
  "CODE"	VARCHAR(50)	NOT NULL,
  "NAME"	VARCHAR(50)	NOT NULL,
  PC	VARCHAR(10),
  "GG"	VARCHAR(20)	NOT NULL,
  "SL"	DECIMAL(18,5)	NOT NULL,
  "UNIT"	VARCHAR(10)	NOT NULL,
  "DJ"	DECIMAL(18,5)	NOT NULL
) 
  IN "SDCSM_TABLE_SPACE";

ALTER TABLE "DB2ADMIN"."TMP_WZ_BS_DETAIL_XLWAF"
  DATA CAPTURE NONE
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;

INSERT INTO "DB2ADMIN"."TMP_WZ_BS_DETAIL_XLWAF"( "ID", "BSHOWID", "CODE", "NAME", "GG", "SL", 

"UNIT", "DJ" )
SELECT "ID", "BSHOWID", "CODE", "NAME", "GG", "SL", "UNIT", "DJ"
FROM "DB2ADMIN"."WZ_BS_DETAIL";

DROP TABLE "DB2ADMIN"."WZ_BS_DETAIL";

RENAME TABLE "DB2ADMIN"."TMP_WZ_BS_DETAIL_XLWAF" TO "WZ_BS_DETAIL";

ALTER TABLE "DB2ADMIN"."WZ_BS_DETAIL"
  ADD CONSTRAINT "PK_WZ_BS_DETAIL" PRIMARY KEY
    ("ID");

GRANT CONTROL ON TABLE "DB2ADMIN"."WZ_BS_DETAIL" TO USER "DB2INST1";

GRANT SELECT, INSERT, UPDATE, ALTER, DELETE,
    INDEX, REFERENCES ON TABLE "DB2ADMIN"."WZ_BS_DETAIL" TO USER "DB2INST1" WITH GRANT OPTION;

GRANT CONTROL ON TABLE "DB2ADMIN"."WZ_BS_DETAIL" TO USER "DB2ADMIN";

GRANT SELECT, INSERT, UPDATE, ALTER, DELETE,
    INDEX, REFERENCES ON TABLE "DB2ADMIN"."WZ_BS_DETAIL" TO USER "DB2ADMIN" WITH GRANT OPTION;


COMMIT;

RUNSTATS ON TABLE "DB2ADMIN"."WZ_BS_DETAIL"
  AND INDEXES ALL
  ALLOW READ ACCESS;

COMMIT;

--2015-04-09 收文附件扩展字段长度
ALTER TABLE "DB2ADMIN"."DOC_REC_MANAGER_FJ"
  ALTER COLUMN "FJMC" SET DATA TYPE VARCHAR(200);

REORG TABLE "DB2ADMIN"."DOC_REC_MANAGER_FJ";

COMMIT;


--2015-04-13 添加日程管理附件上传表
CREATE TABLE "DB2ADMIN".GZ_WORK_SCHEDULE_ATTACHMENT (
  ID	BIGINT	NOT NULL	GENERATED BY DEFAULT
    AS IDENTITY (START WITH 1, INCREMENT BY 1, NO CACHE,
       NO MINVALUE, NO MAXVALUE, NO CYCLE, NO ORDER),
  MID	BIGINT	NOT NULL,
  FJMC	VARCHAR(255)	NOT NULL,
  PATH	VARCHAR(200)	NOT NULL
) ;

ALTER TABLE "DB2ADMIN".GZ_WORK_SCHEDULE_ATTACHMENT
  DATA CAPTURE NONE
  PCTFREE 0
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;

COMMIT;

ALTER TABLE "DB2ADMIN"."GZ_WORK_SCHEDULE_ATTACHMENT"
  ADD PRIMARY KEY
    (ID);
    
COMMIT;

--2015-04-13 案件核查增加字段
ALTER TABLE "DB2ADMIN"."REPORT_CASE"
  ADD COLUMN MAN_DOM VARCHAR(100);
  
ALTER TABLE "DB2ADMIN"."REPORT_CASE"
  ADD COLUMN WOM_DOM VARCHAR(100);
  
ALTER TABLE "DB2ADMIN"."REPORT_CASE"
  ADD COLUMN SEX VARCHAR(1);
  
ALTER TABLE "DB2ADMIN"."REPORT_CASE"
  ADD COLUMN BIRTHDATE VARCHAR(20);
  
ALTER TABLE "DB2ADMIN"."REPORT_CASE"
  ADD COLUMN CARDNO VARCHAR(18);
  
ALTER TABLE "DB2ADMIN"."REPORT_CASE"
  ADD COLUMN SOURCES VARCHAR(100);

COMMENT ON "DB2ADMIN"."REPORT_CASE" ( 
	"MAN_DOM" IS '男方户籍地',
	"WOM_DOM" IS '女方户籍地',
	"SEX" IS '婴儿性别',
	"BIRTHDATE" IS '婴儿出生日期',
	"CARDNO" IS '婴儿身份证号',
	"SOURCES" IS '信息来源' );
	
--2015-04-15 计划生育服务机构手术情况增加字段
ALTER TABLE "DB2ADMIN"."REPORT_JHSY_SSQK"
  ADD COLUMN RQ	VARCHAR(15);

COMMENT ON "DB2ADMIN"."REPORT_JHSY_SSQK" ( 
	"RQ" IS '日期' );

REORG TABLE "DB2ADMIN"."REPORT_JHSY_SSQK";

ALTER TABLE "DB2ADMIN"."REPORT_JHSY_SSQK"
  ALTER COLUMN "LRR"  SET NOT NULL;

REORG TABLE "DB2ADMIN"."REPORT_JHSY_SSQK";

ALTER TABLE "DB2ADMIN"."REPORT_JHSY_SSQK"
  ALTER COLUMN "FLAG"  SET NOT NULL;

REORG TABLE "DB2ADMIN"."REPORT_JHSY_SSQK";

COMMIT;

--2015-04-15 计划生育服务机构工作落实情况增加字段
ALTER TABLE "DB2ADMIN"."REPORT_JHSY_GZQK"
  ALTER COLUMN "LRR"  SET NOT NULL;

REORG TABLE "DB2ADMIN"."REPORT_JHSY_GZQK";

ALTER TABLE "DB2ADMIN"."REPORT_JHSY_GZQK"
  ALTER COLUMN "LRSJ"  SET NOT NULL;

ALTER TABLE "DB2ADMIN"."REPORT_JHSY_GZQK"
  ALTER COLUMN "FLAG"  SET NOT NULL;

ALTER TABLE "DB2ADMIN"."REPORT_JHSY_GZQK"
  ADD COLUMN RQ	VARCHAR(15);

COMMENT ON "DB2ADMIN"."REPORT_JHSY_GZQK" ( 
	"RQ" IS '填报月份' );

REORG TABLE "DB2ADMIN"."REPORT_JHSY_GZQK";

COMMIT;

--2015-04-15 创建新表：新生儿遗传代谢性疾病筛查月报表
CREATE TABLE "DB2ADMIN"."REPORT_NEWBORN_DISEASES" (
  "ID"	BIGINT	NOT NULL	GENERATED BY DEFAULT
    AS IDENTITY (START WITH 1, INCREMENT BY 1, NO CACHE,
       NO MINVALUE, NO MAXVALUE, NO CYCLE, NO ORDER),
  "RQ"	VARCHAR(15)	NOT NULL,
  "DWBM"	VARCHAR(10)	NOT NULL,
  "DWMC"	VARCHAR(50),
  "HCS_BS"	INTEGER,
  "HCS_QTS"	INTEGER,
  "HSC_WS"	INTEGER,
  "SCRS_BS"	INTEGER,
  "SCRS_QTS"	INTEGER,
  "SCRS_WS"	INTEGER,
  "SCRS_CZ"	INTEGER,
  "SCRS_NC"	INTEGER,
  "SCRS_NAN"	INTEGER,
  "SCRS_NV"	INTEGER,
  "SCRS_HJ"	INTEGER,
  "PKU"	INTEGER,
  "CH"	INTEGER,
  "CAH"	INTEGER,
  "G6PD"	INTEGER,
  "LXDH"	VARCHAR(20),
  "LRR"	VARCHAR(10)	NOT NULL,
  "LRSJ"	TIMESTAMP	NOT NULL,
  "SHR"	VARCHAR(10),
  "SHSJ"	TIMESTAMP,
  "FLAG"	VARCHAR(1)	NOT NULL
) 
  IN "USERSPACE1";

ALTER TABLE "DB2ADMIN"."REPORT_NEWBORN_DISEASES"
  DATA CAPTURE NONE
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;

COMMENT ON TABLE "DB2ADMIN"."REPORT_NEWBORN_DISEASES" IS '新生儿遗传代谢性疾病筛查月报表';

COMMENT ON "DB2ADMIN"."REPORT_NEWBORN_DISEASES" ( 
	"ID" IS 'ID',
	"RQ" IS '填报月份',
	"DWBM" IS '单位编码',
	"DWMC" IS '单位名称',
	"HCS_BS" IS '助产机构活产数 本市',
	"HCS_QTS" IS '助产机构活产数 本省其它市',
	"HSC_WS" IS '助产机构活产数 外省',
	"SCRS_BS" IS '筛查人数 本市',
	"SCRS_QTS" IS '筛查人数 本省其它市',
	"SCRS_WS" IS '筛查人数 外省',
	"SCRS_CZ" IS '筛查人数 城镇',
	"SCRS_NC" IS '筛查人数 农村',
	"SCRS_NAN" IS '筛查人数 男',
	"SCRS_NV" IS '筛查人数 女',
	"SCRS_HJ" IS '筛查人数 合计',
	"PKU" IS 'PKU',
	"CH" IS 'CH',
	"CAH" IS 'CAH',
	"G6PD" IS 'G6PD',
	"LXDH" IS '联系电话',
	"LRR" IS '填表人',
	"LRSJ" IS '录入时间',
	"SHR" IS '审核人',
	"SHSJ" IS '审核时间',
	"FLAG" IS '审核状态 0未审核 1已审核 2被退回' );

ALTER TABLE "DB2ADMIN"."REPORT_NEWBORN_DISEASES"
  ADD PRIMARY KEY
    ("ID");
    
--2015-05-05健康证明添加收费收费标示
CREATE TABLE "DB2ADMIN"."TMP_HEALTHY_CERTIFICATE_KIHCY" (
  "ID"	BIGINT	NOT NULL	GENERATED BY DEFAULT
    AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 20,
       NO MINVALUE, NO MAXVALUE, NO CYCLE, NO ORDER),
  "CODE"	VARCHAR(10)	NOT NULL,
  "NAME"	VARCHAR(50)	NOT NULL,
  "ISQUALIFIED"	VARCHAR(1)	NOT NULL,
  ISCHARGE	CHARACTER(1),
  "AGE"	INTEGER,
  "XB"	VARCHAR(1),
  "WORKTYPE"	VARCHAR(10),
  "DWMC"	VARCHAR(50),
  "GIVEDATE"	TIMESTAMP	NOT NULL,
  "REGION"	VARCHAR(10),
  "FILEPATH"	VARCHAR(200),
  "ISPHOTO"	CHARACTER(1)
) 
  IN "USERSPACE1";

ALTER TABLE "DB2ADMIN"."TMP_HEALTHY_CERTIFICATE_KIHCY"
  DATA CAPTURE NONE
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;

COMMENT ON "DB2ADMIN"."TMP_HEALTHY_CERTIFICATE_KIHCY" ( 
	ISCHARGE IS '是否收费 0未收费 /1已收费',
	"FILEPATH" IS '照片文件路径',
	"ISPHOTO" IS '是否拍照 0未拍照 /1已拍照' );

INSERT INTO "DB2ADMIN"."TMP_HEALTHY_CERTIFICATE_KIHCY"( "ID", "CODE", "NAME", "ISQUALIFIED", "AGE", "XB", "WORKTYPE", "DWMC", "GIVEDATE", "REGION", "FILEPATH", "ISPHOTO" )
SELECT "ID", "CODE", "NAME", "ISQUALIFIED", "AGE", "XB", "WORKTYPE", "DWMC", "GIVEDATE", "REGION", "FILEPATH", "ISPHOTO"
FROM "DB2ADMIN"."HEALTHY_CERTIFICATE";

DROP TABLE "DB2ADMIN"."HEALTHY_CERTIFICATE";

RENAME TABLE "DB2ADMIN"."TMP_HEALTHY_CERTIFICATE_KIHCY" TO "HEALTHY_CERTIFICATE";

ALTER TABLE "DB2ADMIN"."HEALTHY_CERTIFICATE"
  ADD CONSTRAINT "PK_HEALTHY_CERTIFICATE" PRIMARY KEY
    ("ID");


COMMIT;

RUNSTATS ON TABLE "DB2ADMIN"."HEALTHY_CERTIFICATE"
  AND INDEXES ALL
  ALLOW READ ACCESS;

COMMIT;

